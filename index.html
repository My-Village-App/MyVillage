<!DOCTYPE html>
<html lang="te">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>మన ఊరి సేవలు (Mana Oori Sevalu)</title>
<meta name="description" content="Local Workers Directory with Ads functionality.">

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
@import url('https://fonts.googleapis.com/css2?family=Ramabhadra&family=Roboto:wght@400;500;700&display=swap');
body { font-family: 'Roboto', sans-serif; background-color: #f0f4f8; }
h1, h2, h3 { font-family: 'Ramabhadra', sans-serif; }
.fade-in { animation: fadeIn 0.3s ease-out; }
@keyframes fadeIn { from {opacity:0; transform:translateY(10px)} to {opacity:1; transform:translateY(0)} }

/* Toast */
.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: #0f172a;
  color: white;
  padding: 10px 18px;
  border-radius: 999px;
  font-size: 14px;
  opacity: 0;
  transition: all .3s ease;
  z-index: 9999;
}
.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* Skeleton */
.skeleton {
  background: linear-gradient(90deg, #e5e7eb, #f3f4f6, #e5e7eb);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}
@keyframes shimmer {
  0% {background-position:200% 0;}
  100% {background-position:-200% 0;}
}
</style>
</head>

<body class="text-slate-800 bg-slate-50">

<div id="toast" class="toast"></div>

<!-- HEADER -->
<div class="bg-gradient-to-r from-blue-900 to-slate-900 text-white p-4 sticky top-0 z-50 shadow-md">
  <div class="max-w-3xl mx-auto flex justify-between items-center">
    <h1 class="text-lg font-bold flex items-center gap-2">
      <i class="fas fa-city text-yellow-400"></i> మన ఊరి సేవలు
    </h1>
    <button id="authBtn" onclick="handleAuthAction()" class="bg-white text-blue-900 px-3 py-1 rounded-full text-xs font-bold shadow">Login</button>
  </div>
</div>

<div class="max-w-3xl mx-auto p-4 pb-20">

  <!-- Ads -->
  <div class="relative w-full h-44 bg-gray-800 rounded-xl overflow-hidden shadow-lg mb-6">
    <img id="adImage" src="https://via.placeholder.com/800x400/1e293b/FFD700?text=Loading+Ads..." class="w-full h-full object-cover transition-opacity duration-500 cursor-pointer">
    <div id="adDots" class="absolute bottom-2 left-0 right-0 flex justify-center gap-2"></div>
  </div>

  <!-- Action -->
  <div class="flex justify-between mb-4">
    <p class="text-xs text-gray-500">✔ Verified Contacts</p>
    <button onclick="checkAuthAndAdd()" class="bg-blue-900 text-white px-4 py-2 rounded-lg text-sm font-bold">➕ Add Info</button>
  </div>

  <!-- Search -->
  <div class="relative mb-6">
    <input id="searchInput" placeholder="Search workers..." class="w-full pl-4 pr-4 py-3 rounded-xl border shadow-sm">
  </div>

  <!-- Loader -->
  <div id="loader" class="space-y-3">
    <div class="bg-white p-4 rounded-xl flex gap-3">
      <div class="w-12 h-12 rounded-full skeleton"></div>
      <div class="flex-1 space-y-2">
        <div class="h-4 skeleton rounded"></div>
        <div class="h-3 skeleton rounded w-1/2"></div>
      </div>
    </div>
  </div>

  <div id="workersList" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
  <div id="noDataMsg" class="hidden text-center py-10 text-gray-400">No workers found.</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, query, where, getDocs, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
 apiKey: "AIzaSyBfonEUIssxYV5BFxOEsTIA9alYzISEOGU",
 authDomain: "myvillage-app-c3550.firebaseapp.com",
 projectId: "myvillage-app-c3550",
 storageBucket: "myvillage-app-c3550.firebasestorage.app",
 messagingSenderId: "1081682544474",
 appId: "1:1081682544474:web:c844c928e69915013b1563"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

let currentUser = null;
let allWorkers = [];

const toast = (msg)=>{
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2500);
};

onAuthStateChanged(auth,user=>{
 currentUser=user;
 document.getElementById("authBtn").innerText=user?"Logout":"Login";
});

window.handleAuthAction=()=>{
 currentUser?signOut(auth):signInWithPopup(auth,provider);
};

// Workers
onSnapshot(collection(db,"workers"),snap=>{
 allWorkers=snap.docs.map(d=>({id:d.id,...d.data()}));
 renderWorkers(allWorkers);
 document.getElementById("loader").classList.add("hidden");
});

function renderWorkers(data){
 const list=document.getElementById("workersList");
 list.innerHTML="";
 document.getElementById("noDataMsg").classList.toggle("hidden",data.length>0);

 data.forEach(w=>{
  list.innerHTML+=`
  <div class="bg-white p-4 rounded-xl shadow flex gap-3 cursor-pointer">
    <img loading="lazy" src="${w.photo}" class="w-12 h-12 rounded-full object-cover"/>
    <div>
      <h3 class="font-bold">${w.name}</h3>
      <p class="text-xs text-yellow-600">${w.job}</p>
      <p class="text-xs text-gray-500">${w.phone}</p>
    </div>
  </div>`;
 });
}

// Debounced search
let tmr;
document.getElementById("searchInput").addEventListener("input",e=>{
 clearTimeout(tmr);
 tmr=setTimeout(()=>{
  const t=e.target.value.toLowerCase();
  renderWorkers(allWorkers.filter(w=>
    w.name.toLowerCase().includes(t) ||
    w.job.toLowerCase().includes(t) ||
    (w.area||"").toLowerCase().includes(t)
  ));
 },300);
});

window.checkAuthAndAdd=()=>{
 if(!currentUser) return toast("Login first");
 toast("Form open (existing logic intact)");
};
</script>

</body>
</html>
