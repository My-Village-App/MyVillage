<!DOCTYPE html><html lang="te">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∞Æ‡∞® ‡∞ä‡∞∞‡∞ø ‡∞∏‡±á‡∞µ‡∞≤‡±Å - Pro UI</title>  <!-- Tailwind -->  <script src="https://cdn.tailwindcss.com"></script>  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">  <style>
    body { background: #f8fafc; }

    /* Toast */
    .toast {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(20px);
      background: #0f172a; color: white; padding: 10px 18px; border-radius: 999px;
      font-size: 14px; opacity: 0; transition: all 0.3s ease; z-index: 9999;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* Skeleton loader */
    .skeleton { background: linear-gradient(90deg, #eee, #f5f5f5, #eee); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

    /* Modal animation */
    .fade-scale { animation: fadeScale 0.25s ease-out; }
    @keyframes fadeScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
  </style></head>
<body class="text-slate-800"><!-- Toast --><div id="toast" class="toast"></div><!-- Header --><header class="sticky top-0 bg-gradient-to-r from-blue-900 to-indigo-900 text-white p-4 shadow z-50">
  <div class="max-w-4xl mx-auto flex justify-between items-center">
    <h1 class="font-bold text-lg flex items-center gap-2">
      <i class="fas fa-city text-yellow-400"></i> ‡∞Æ‡∞® ‡∞ä‡∞∞‡∞ø ‡∞∏‡±á‡∞µ‡∞≤‡±Å
    </h1>
    <button id="authBtn" onclick="handleAuthAction()" class="bg-white text-blue-900 px-3 py-1 rounded-full text-sm font-bold">Login</button>
  </div>
</header><!-- Container --><main class="max-w-4xl mx-auto p-4">  <!-- Hero Search -->  <div class="bg-white p-5 rounded-2xl shadow mb-6">
    <h2 class="text-xl font-bold mb-2">üîç ‡∞Æ‡±Ä ‡∞∏‡±á‡∞µ‡∞≤‡∞®‡±Å ‡∞µ‡±Ü‡∞§‡∞ï‡∞Ç‡∞°‡∞ø</h2>
    <input id="searchInput" placeholder="Electrician, Auto, Plumber..." class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-yellow-400 outline-none" />
  </div>  <!-- Add Button -->  <div class="flex justify-end mb-4">
    <button onclick="toggleForm()" class="bg-blue-900 text-white px-5 py-2 rounded-xl shadow hover:bg-blue-800">‚ûï Add Worker</button>
  </div>  <!-- Workers Grid -->  <div id="workersList" class="grid sm:grid-cols-2 gap-4"></div>
</main><!-- Add Worker Modal --><div id="addForm" class="hidden fixed inset-0 bg-black/60 flex justify-center items-center p-4 z-50">
  <div class="bg-white p-6 rounded-2xl w-full max-w-md fade-scale">
    <h2 class="text-xl font-bold mb-4">Add Worker</h2><input type="file" id="photoInput" accept="image/*" onchange="previewImage(this)" class="mb-3" />
<div id="photoPreview" class="w-24 h-24 bg-gray-100 rounded-full mb-3 overflow-hidden"></div>

<input id="wName" placeholder="Name" class="w-full p-2 border rounded mb-2" />
<input id="wJob" placeholder="Job" class="w-full p-2 border rounded mb-2" />
<input id="wPhone" placeholder="Phone" class="w-full p-2 border rounded mb-2" />

<button onclick="saveWorker()" class="w-full bg-blue-900 text-white py-2 rounded">Save</button>
<button onclick="toggleForm()" class="w-full mt-2 text-sm text-gray-500">Cancel</button>

  </div>
</div><!-- Firebase --><script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBfonEUIssxYV5BFxOEsTIA9alYzISEOGU",
    authDomain: "myvillage-app-c3550.firebaseapp.com",
    projectId: "myvillage-app-c3550",
    storageBucket: "myvillage-app-c3550.appspot.com",
    messagingSenderId: "1081682544474",
    appId: "1:1081682544474:web:c844c928e69915013b1563"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const storage = getStorage(app);
  const provider = new GoogleAuthProvider();

  let currentUser = null;
  let selectedFile = null;
  let allWorkers = [];

  const toast = (msg) => {
    const t = document.getElementById('toast');
    t.innerText = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2500);
  };

  onAuthStateChanged(auth, user => {
    currentUser = user;
    document.getElementById('authBtn').innerText = user ? 'Logout' : 'Login';
  });

  window.handleAuthAction = () => {
    currentUser ? signOut(auth) : signInWithPopup(auth, provider);
  };

  window.toggleForm = () => document.getElementById('addForm').classList.toggle('hidden');

  window.previewImage = (input) => {
    selectedFile = input.files[0];
    const reader = new FileReader();
    reader.onload = e => {
      document.getElementById('photoPreview').innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover"/>`;
    };
    reader.readAsDataURL(selectedFile);
  };

  async function uploadImage(file) {
    const storageRef = ref(storage, `workers/${Date.now()}_${file.name}`);
    await uploadBytes(storageRef, file);
    return await getDownloadURL(storageRef);
  }

  window.saveWorker = async () => {
    if (!currentUser) return toast('Login first');
    if (!selectedFile) return toast('Select image');

    const imgUrl = await uploadImage(selectedFile);

    await addDoc(collection(db, 'workers'), {
      name: document.getElementById('wName').value,
      job: document.getElementById('wJob').value,
      phone: document.getElementById('wPhone').value,
      photo: imgUrl,
      uid: currentUser.uid
    });

    toast('Saved successfully');
    toggleForm();
  };

  // Skeleton loader initially
  const list = document.getElementById('workersList');
  for(let i=0;i<4;i++){
    list.innerHTML += `<div class="bg-white p-4 rounded-xl shadow flex items-center gap-3"><div class="w-14 h-14 rounded-full skeleton"></div><div class="flex-1 space-y-2"><div class="h-4 skeleton rounded"></div><div class="h-3 skeleton rounded w-1/2"></div></div></div>`;
  }

  onSnapshot(collection(db, 'workers'), snap => {
    allWorkers = snap.docs.map(d => d.data());
    renderWorkers(allWorkers);
  });

  function renderWorkers(data) {
    const list = document.getElementById('workersList');
    list.innerHTML = '';

    data.forEach(w => {
      list.innerHTML += `
        <div class="bg-white p-4 rounded-xl shadow flex items-center gap-3">
          <img loading="lazy" src="${w.photo}" class="w-14 h-14 rounded-full object-cover" />
          <div>
            <h3 class="font-bold">${w.name}</h3>
            <p class="text-sm text-yellow-600">${w.job}</p>
            <p class="text-xs text-gray-500">üìû ${w.phone}</p>
          </div>
        </div>
      `;
    });
  }

  // Debounced search
  let timer;
  document.getElementById('searchInput').addEventListener('input', e => {
    clearTimeout(timer);
    timer = setTimeout(() => {
      const t = e.target.value.toLowerCase();
      renderWorkers(allWorkers.filter(w => w.name.toLowerCase().includes(t) || w.job.toLowerCase().includes(t)));
    }, 300);
  });
</script></body>
</html>
